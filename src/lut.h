#ifndef LUT_H
#define LUT_H

#include <stdint.h>

/*
 * Sigmoid LUT: input [-8,8] -> 256 entries, output Q15 [0,32767]
 * Index = (pre_act >> shift) + 128, where shift maps range to [-128,127]
 */
static const int16_t sigmoid_lut_q15[256] = {
       10,    11,    12,    13,    14,    15,    15,    17,
       18,    19,    20,    21,    23,    24,    26,    28,
       29,    31,    33,    36,    38,    40,    43,    46,
       49,    52,    55,    59,    63,    67,    71,    76,
       81,    86,    91,    97,   103,   110,   117,   125,
      133,   141,   151,   160,   171,   182,   193,   206,
      219,   233,   248,   264,   281,   299,   318,   338,
      360,   382,   407,   433,   460,   490,   521,   554,
      589,   626,   666,   708,   752,   800,   850,   903,
      960,  1020,  1084,  1151,  1223,  1298,  1379,  1464,
     1554,  1649,  1749,  1856,  1968,  2087,  2213,  2345,
     2485,  2633,  2788,  2952,  3124,  3305,  3495,  3695,
     3905,  4126,  4356,  4598,  4851,  5115,  5390,  5678,
     5977,  6289,  6612,  6948,  7297,  7657,  8030,  8415,
     8812,  9220,  9640, 10071, 10512, 10963, 11424, 11893,
    12370, 12855, 13347, 13844, 14346, 14852, 15360, 15871,
    16383, 16895, 17406, 17914, 18420, 18922, 19419, 19911,
    20396, 20873, 21342, 21803, 22254, 22695, 23126, 23546,
    23954, 24351, 24736, 25109, 25469, 25818, 26154, 26477,
    26789, 27088, 27376, 27651, 27915, 28168, 28410, 28640,
    28861, 29071, 29271, 29461, 29642, 29814, 29978, 30133,
    30281, 30421, 30553, 30679, 30798, 30910, 31017, 31117,
    31212, 31302, 31387, 31468, 31543, 31615, 31682, 31746,
    31806, 31863, 31916, 31966, 32014, 32058, 32100, 32140,
    32177, 32212, 32245, 32276, 32306, 32333, 32359, 32384,
    32406, 32428, 32448, 32467, 32485, 32502, 32518, 32533,
    32547, 32560, 32573, 32584, 32595, 32606, 32615, 32625,
    32633, 32641, 32649, 32656, 32663, 32669, 32675, 32680,
    32685, 32690, 32695, 32699, 32703, 32707, 32711, 32714,
    32717, 32720, 32723, 32726, 32728, 32730, 32733, 32735,
    32737, 32738, 32740, 32742, 32743, 32745, 32746, 32747,
    32748, 32749, 32751, 32751, 32752, 32753, 32754, 32755
};

/*
 * Tanh LUT: input [-4,4] -> 256 entries, output Q15 [-32768,32767]
 * Index = (pre_act >> shift) + 128
 */
static const int16_t tanh_lut_q15[256] = {
   -32745,-32743,-32742,-32740,-32738,-32736,-32735,-32732,
   -32730,-32728,-32725,-32723,-32720,-32717,-32714,-32710,
   -32707,-32703,-32699,-32694,-32690,-32685,-32680,-32674,
   -32668,-32662,-32655,-32648,-32640,-32632,-32623,-32614,
   -32604,-32594,-32583,-32571,-32559,-32545,-32531,-32516,
   -32500,-32483,-32464,-32445,-32424,-32402,-32379,-32354,
   -32328,-32300,-32270,-32238,-32204,-32168,-32130,-32090,
   -32046,-32001,-31952,-31900,-31845,-31786,-31724,-31658,
   -31588,-31513,-31434,-31350,-31261,-31166,-31065,-30959,
   -30846,-30726,-30598,-30463,-30320,-30169,-30008,-29838,
   -29658,-29468,-29267,-29054,-28829,-28591,-28340,-28075,
   -27795,-27500,-27190,-26862,-26518,-26156,-25775,-25375,
   -24955,-24514,-24053,-23570,-23064,-22536,-21985,-21410,
   -20811,-20188,-19541,-18869,-18172,-17451,-16705,-15935,
   -15142,-14325,-13485,-12624,-11742,-10840, -9918, -8980,
    -8025, -7055, -6072, -5078, -4074, -3062, -2045, -1023,
        0,  1023,  2045,  3062,  4074,  5078,  6072,  7055,
     8025,  8980,  9918, 10840, 11742, 12624, 13485, 14325,
    15142, 15935, 16705, 17451, 18172, 18869, 19541, 20188,
    20811, 21410, 21985, 22536, 23064, 23570, 24053, 24514,
    24955, 25375, 25775, 26156, 26518, 26862, 27190, 27500,
    27795, 28075, 28340, 28591, 28829, 29054, 29267, 29468,
    29658, 29838, 30008, 30169, 30320, 30463, 30598, 30726,
    30846, 30959, 31065, 31166, 31261, 31350, 31434, 31513,
    31588, 31658, 31724, 31786, 31845, 31900, 31952, 32001,
    32046, 32090, 32130, 32168, 32204, 32238, 32270, 32300,
    32328, 32354, 32379, 32402, 32424, 32445, 32464, 32483,
    32500, 32516, 32531, 32545, 32559, 32571, 32583, 32594,
    32604, 32614, 32623, 32632, 32640, 32648, 32655, 32662,
    32668, 32674, 32680, 32685, 32690, 32694, 32699, 32703,
    32707, 32710, 32714, 32717, 32720, 32723, 32725, 32728,
    32730, 32732, 32735, 32736, 32738, 32740, 32742, 32743
};

static inline int16_t lut_sigmoid_q15(int32_t pre_act, int shift) {
    int32_t idx = (pre_act >> shift) + 128;
    if (idx < 0) idx = 0;
    if (idx > 255) idx = 255;
    return sigmoid_lut_q15[idx];
}

static inline int16_t lut_tanh_q15(int32_t pre_act, int shift) {
    int32_t idx = (pre_act >> shift) + 128;
    if (idx < 0) idx = 0;
    if (idx > 255) idx = 255;
    return tanh_lut_q15[idx];
}

#endif
